OpenMolcas Interface {#molcas}
=============================

[OpenMolcas](https://molcas.gitlab.io/OpenMolcas/sphinx/) is a widely used quantum chemistry package which specializes in multiconfigurational approaches.
Here, we focus on how to use the software in tandem with OpenCAP to perform calculations on resonances. 

System
======

OpenCAP can extract the basis set and geometry from two types of files generated by OpenMolcas:
Molden, and rassi.h5. Set the "molecule" keyword to either "molden" or "molcas_rassi", and
then set "basis_file" to the properly formatted molden/rassi.h5 file. The geometry and 
basis set can also be specified manually by setting the "molecule" keyword to inline, and
setting "basis_file" to a basis set file specified in Psi4 format. Basis sets can be downloaded from the [MolSSI](https://www.basissetexchange.org/) and modified to suit your purposes.

__Relevant keywords__
| Keyword    | Valid options                     | Description                                                                                                                                                                                                                                                                                      |
|------------|-----------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| molecule   | molden,rassi_h5,inline            | Specifies which format to read the molecular geometry. If "inline" is chosen, the "$geometry" section is also required.                                                                                                                                                                          |
| basis_file | path to basis file                | Specifies the path to the basis file. When "molecule" is set to "molden","rassi_h5", or "qchem_fchk", this keyword should be set to a path to a file of the specified type. When "molecule" is set to  "inline", this keyword should be set to a path to a basis set file formatted in "Psi4" style. |

CAP
=============

The key to the OpenMolcas interface is the RAS State Interaction program (RASSI). As stated
in the OpenMolcas reference, RASSI "computes matrix elements of the Hamiltonian and 
other operators in a wave function basis, which consists of individually optimized CI 
expansions from the RASSCF program". Of crucial importance to us is that RASSI is able to
compute and export one particle transition density matrices between each pair of states. 
When the 'TRD1' keyword is activated, these densities are exported to an HDF5 file 
titled $JOBNAME.rassi.h5. 

	 &RASSI
	 TRD1

OpenCAP uses these densities to compute the 
%CAP matrix elements in state basis, which is required to perform perturbative %CAP 
calculations.

In addition to the one particle densities, OpenCAP also requires a zeroth order Hamiltonian.
For a proper description of correlation, an effective Hamiltonian from a multi-state 
second order perturbation theory method is required. OpenCAP is capable of reading the 
effective Hamiltonian from OpenMolcas outputs for the following methods: 
MS-CASPT2,XMS-CASPT2.

__Relevant keywords__
| Keyword | Type | Description |
|---------------|--------|---------------------------------------------------------|
| rassi_h5 | string | Relative or absolute path to rassi.h5 file containing TDMs.     |
| molcas_output | string | Relative or absolute path to OpenMolcas output file.   |
| h0_file | string | Relative or absolute path to properly formatted zeroth order Hamiltonian file.   |


__Example input__

    $system
    molecule molden
    basis_file nosymm.rasscf.molden
    $end

    $perturb_cap
    method ms-caspt2
    package openmolcas
    rassi_h5 nosymm.rassi.h5
    h0_file heff.in
    !molcas_output nosymm.out
    nstates 10
    CAP_TYPE box
    CAP_X 2.76
    CAP_Y 2.76
    CAP_Z 4.88
    Radial_precision  14
    Angular_points    110
    $end

    $job
    title MS-CASPT2(5,10) with 10 states for N2-, symmetry turned off
    jobtype perturb_cap
    $end
    
More inputs are available in our [repository](https://github.com/gayverjr/opencap/tree/master/examples/opencap).
